# Use case 26. 지도 매물 시각화
**GENERAL CHARACTERISTICS**<br>
* * *
**Summary**<br>
사용자의 지도 화면에 매물 위치를 아이콘으로 표시한다.<br>
**Scope**<br>
**Level**<br>
**Author**<br>
**Last Update**<br>
**Status**<br>
**Primary Actor**<br>
**Preconditions**<br>
**Trigger**<br>
**Success Post Conditions**<br>
* * *
**MAIN SUCCESS SCENARIO**<br>
**Step** Action<br>
**S**<br>
**1**<br>
**2**<br>
**3**<br>
**4**<br>
**5**<br>
* * *
**EXTENSION SCENARIOS**<br>
**Step**<br>
****
* * *
**RELATED IMFORMATION**<br>
**Performance**<br>
**Frequency**<br>
**<Concurrency>**<br>
**Due Date**<br>
* * *

	네이버 지도 API를 이용하여 지도를 띄운다.
	로그인을 하지 않아 토큰이 없으면 오류 메시지를 띄우며 로그인 페이지로 이동한다.
	지도 호출 실패시 재시도 및 오류를 출력한다.
	등록된 매물의 위치 정보를 불러와 지도에 마커와 함께 표시한다
	매물의 상태 정보 [available|pending|sold]을 기준으로 색상을 달리하며 마커의 색상을 변경한다.
	매물 클릭시 매물의 정보를 properties , property_images, property_offers table에서 받아와 각 정보를 띄운다. 
	일정 시간 후 지도를 재조회 하여 새로운 정보를 받아와 지도에 띄운다.
	지도의 줌*팬 이벤트 발생 시 범위 재조회 및 마커 갱신한다.
	사용자 지정 조건 필터 적용 시 해당 매물만 표시한다.

  
**Use case 27. 사용자 위치 표시**
현재 사용자 위치를 표시한다	
	사용자의 현재 위치를 받아올 수 있으면 중심을 그 위치로 옮긴다.
	사용자의 현재 위치를 받아오지 못하면 시청을 중심을 디폴트 값으로 지정한다.
	현재 gps를 받아올지 사용자에게 승인을 받는다.
사용자가 고정한 지도 위치를 저장하여 재방문 시 재사용한다	
	현재 위치 고정' 버튼 클릭 시 지도 중심 좌표를 사용자 설정으로 DB에 갱신 저장한다.
	사용자가 지도에서 '현재 위치 고정' 버튼 클릭 시 DB에 갱신 저장이 된다.

  
**Use case 28. 지도 매물 즐겨찾기**
즐겨찾기를 조회한다	
	즐겨찾기 탭 클릭 시 저장된 즐겨찾기 목록을 조회하여 표시한다,
	현재 로그인된 아이디의 토큰을 받아와 그와 일치하는 즐겨찾기 매물을 표시한다.
조회된 매물 정보 확인한다	
	즐겨찾기 목록 항목 클릭 시 지도 중심을 해당 매물 좌표로 이동하고 상세정보 창을 연다.
정보확인에 실패한다	
	정보 확인 실패시 실패 원인과 함께 상단에 띄운다.
즐겨찾기 추가한다	
	매물에서 하트 버튼을 클릭시 즐겨찾기 클릭시 현재 로그인된 아이디의 토큰으로 id를 받아와서 즐겨찾기에 등록한다.
	즐겨찾기 등록시 즐겨찾기 하트 버튼 빨간색으로 변한뒤 favorites table에서 data를 추가한다.
즐겨찾기 제거한다	
	빨같게 켜져있는 즐겨찾기 버튼을 클릭시 현재 로그인이 되어있는 아이디의 토큰을 받아와서 즐겨찾기를 해재한다.
	즐겨찾기 해제시 즐겨찾기 하트 버튼 회색으로 변한뒤 favorites table에서 data를 지운다.
  
**Use case 29. 매물 상세정보 표시**
매물 클릭시 매물 정보표시창를 표시한다	
	마커 클릭시 property_id를 획득하고 api로 호출하여 세부 정보를 수신 받는다.
	수신 받은 정보를 사이드바에 렌더링하여 표시한다.
매물 정보 표시를 실패한다	 
	매물 정보 표시 실패시 실패 표시와 함께 화면을 새로고침 한다.

**Use case 30. 필터**
개별 필터를 지정한다	
	필터를 지정시 매물 property_offers, properties의 정보를 받아와서 지도에 그의 맞는 매물 표시한다.
	필터 등록된 정보는 지도가 재호출 될때는 버튼 클릭을 완료시에 지정된다.
	필터를 지정하지 않으면 모든 매물을 띄운다.
종합 필터를 지정한다	
	모든 필터를 한번에 지정후 적용 버튼을 클릭시 필터가 적용된다.
필터 지정에 실패한다	
	필터 지정 실패시 오류 메시지와 함께 필터가 헤제된다.

**Use case 34. 추천 매물**
AI 기반 알고리즘을 통해 사용자의 관심사와 선호도를 분석하여 개인화된 매물을 추천하는 기능	
	사용자가 로그인하면 왼쪽 카드 패널의 추천매물 섹션에 접근이 가능하다.
	일정 개수의 매물을 보기 전이라면 현재까지 클릭한 매물 수를 표시한다.
	사용자가 매물을 클릭하여 상세페이지에 진입할 때, DB에 자동으로 사용자 ID, 매물ID + 매물 속성 정보를 저장한다.
	조회한 매물 수가 일정 개수 이상이 되었는지 확인 후, 되었다면 계산하는 트리거가 발동된다.
	수집된 데이터의 유효성 검증, 범주형 데이터의 원-핫 인코딩 변환, 수치형 데이터는 정규화 처리를 수행한다.
	전체 매물 DB의 모든 매물을 동일한 방식으로 벡터화한다.
	각 벡터와 사용자 프로필 벡터 간의 유사도를 계산하여 높은 순서대로 매물을 정렬한다.
	추천 매물 섹션에 정렬된 순서대로 매물을 표시한다.
	다른 매물을 클릭하면 다시 계산해서 높은 순서대로 재정렬한다.
	같은 매물을 한 번 더 조회하게 되면 별도의 감점을 줘서 추천 매물에 표시가 되지 않게 한다.
